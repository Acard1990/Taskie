<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Homepage</title>
    </head>
    <body>
        <nav>
            <ul>
                <li><a href="/auth/logout">Log out</a></li>
                <li><a href="/auth/login">Login</a></li>
                <li><a href="/">Homepage</a></li>
                <li><a href="/profile">Profile</a></li>
            </ul>
        </nav>
        <p>Hello, The UserID is: {{user.id}} {{user.firstName}} {{user.lastName}}</p>
        <form action="/api/task" method="post">
          <div class="form-group">
            <label>Task</label>
            <input type="text" class="form-control" name="task">
          </div>
          <button type="submit" class="btn btn-warning btn-lg">Add</button>
        </form>
        <div id="myTasks">
          <h2>My Tasks</h2>
        </div>

        <div id="allTasks">
          <h2>Others' Tasks</h2>
        </div>

        <div id="pickedUp">
          <h2>My Picked Up Tasks</h2>
        </div>

        <script>
          var userTaskDiv = $('#myTasks');
          var pickedUpDiv = $('#pickedUp');
          var allTasksDiv = $('#allTasks');

          $.ajax({
            url: '/api/profile',
            method: 'GET'
          }).then((response) => {
            console.log(response);
            for (var i=0; i<response.length; i++) {
              if (response[i].UserId == {{user.id}}) {
                let p = $(`<p>${response[i].description}</p>`);
                userTaskDiv.append(p);
              } else if (response[i].Assignment !== null && response[i].Assignment.UserId == {{user.id}}) {
                let p = $(`<p>${response[i].description}</p>`);
                pickedUpDiv.append(p);
              } else {
                let p = $(`<p>${response[i].description}</p>`);
                let btn = (`<button class="pickUp" data-id="${response[i].id}">Pick Up</button>`);
                p.append(btn);
                allTasksDiv.append(p);
              }
            }
          });

          $(document).on('click', '.pickUp', function(event){
            event.preventDefault();
            let id = $(this).data('id');
            console.log(id);
            $.ajax({
              url: '/api/grab/task/' + id,
              method: 'POST'
            }).then((response) => {
              console.log("Picked up");
            });
          });
        </script>
    </body>
</html>
